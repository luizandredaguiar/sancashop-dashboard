<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Sancashop</title>
  
  <!-- Bibliotecas necessárias -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <script src="https://unpkg.com/recharts@2.1.9/umd/Recharts.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
  <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
  
  <style>
    .loading-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="root">
    <div class="loading-container">
      <div class="spinner"></div>
      <div>Carregando Dashboard Sancashop...</div>
    </div>
  </div>

  <!-- Simulação de leitura de arquivos -->
  <script>
    // Dados simulados para substituir os arquivos Excel
    const DADOS_TRANSACOES = [
      // Janeiro
      { Local: "Condomínio A", Datahora: "2025-01-02T10:30:00", PrecoVenda: 150.50 },
      { Local: "Condomínio A", Datahora: "2025-01-03T14:20:00", PrecoVenda: 200.75 },
      { Local: "Condomínio A", Datahora: "2025-01-06T16:45:00", PrecoVenda: 120.30 },
      { Local: "Condomínio B", Datahora: "2025-01-07T09:15:00", PrecoVenda: 180.25 },
      { Local: "Condomínio B", Datahora: "2025-01-08T11:40:00", PrecoVenda: 250.00 },
      { Local: "Condomínio C", Datahora: "2025-01-09T13:50:00", PrecoVenda: 195.80 },
      { Local: "Condomínio D", Datahora: "2025-01-10T12:10:00", PrecoVenda: 175.40 },
      { Local: "Condomínio E", Datahora: "2025-01-13T15:30:00", PrecoVenda: 220.60 },
      
      // Janeiro - fins de semana
      { Local: "Condomínio A", Datahora: "2025-01-04T10:30:00", PrecoVenda: 350.50 },
      { Local: "Condomínio A", Datahora: "2025-01-05T14:20:00", PrecoVenda: 400.75 },
      { Local: "Condomínio B", Datahora: "2025-01-04T09:15:00", PrecoVenda: 380.25 },
      { Local: "Condomínio B", Datahora: "2025-01-05T11:40:00", PrecoVenda: 450.00 },
      { Local: "Condomínio C", Datahora: "2025-01-04T13:50:00", PrecoVenda: 395.80 },
      { Local: "Condomínio D", Datahora: "2025-01-05T12:10:00", PrecoVenda: 375.40 },
      { Local: "Condomínio E", Datahora: "2025-01-04T15:30:00", PrecoVenda: 420.60 },
      
      // Fevereiro
      { Local: "Condomínio A", Datahora: "2025-02-03T10:30:00", PrecoVenda: 160.50 },
      { Local: "Condomínio A", Datahora: "2025-02-04T14:20:00", PrecoVenda: 210.75 },
      { Local: "Condomínio A", Datahora: "2025-02-05T16:45:00", PrecoVenda: 130.30 },
      { Local: "Condomínio B", Datahora: "2025-02-06T09:15:00", PrecoVenda: 190.25 },
      { Local: "Condomínio B", Datahora: "2025-02-07T11:40:00", PrecoVenda: 260.00 },
      { Local: "Condomínio C", Datahora: "2025-02-10T13:50:00", PrecoVenda: 205.80 },
      { Local: "Condomínio D", Datahora: "2025-02-11T12:10:00", PrecoVenda: 185.40 },
      { Local: "Condomínio E", Datahora: "2025-02-12T15:30:00", PrecoVenda: 230.60 },
      
      // Fevereiro - fins de semana
      { Local: "Condomínio A", Datahora: "2025-02-01T10:30:00", PrecoVenda: 360.50 },
      { Local: "Condomínio A", Datahora: "2025-02-02T14:20:00", PrecoVenda: 410.75 },
      { Local: "Condomínio B", Datahora: "2025-02-01T09:15:00", PrecoVenda: 390.25 },
      { Local: "Condomínio B", Datahora: "2025-02-02T11:40:00", PrecoVenda: 460.00 },
      { Local: "Condomínio C", Datahora: "2025-02-01T13:50:00", PrecoVenda: 405.80 },
      { Local: "Condomínio D", Datahora: "2025-02-02T12:10:00", PrecoVenda: 385.40 },
      { Local: "Condomínio E", Datahora: "2025-02-02T15:30:00", PrecoVenda: 430.60 }
    ];
    
    const DADOS_APTS = [
      { CodigoLoja: "Condomínio A", NumeroQuartos_1: 20, NumeroQuartos_2: 30, NumeroQuartos_3: 15, NumeroQuartos_4: 5, NumeroQuartos_5: 0 },
      { CodigoLoja: "Condomínio B", NumeroQuartos_1: 15, NumeroQuartos_2: 25, NumeroQuartos_3: 20, NumeroQuartos_4: 10, NumeroQuartos_5: 5 },
      { CodigoLoja: "Condomínio C", NumeroQuartos_1: 10, NumeroQuartos_2: 20, NumeroQuartos_3: 25, NumeroQuartos_4: 15, NumeroQuartos_5: 5 },
      { CodigoLoja: "Condomínio D", NumeroQuartos_1: 25, NumeroQuartos_2: 35, NumeroQuartos_3: 10, NumeroQuartos_4: 5, NumeroQuartos_5: 0 },
      { CodigoLoja: "Condomínio E", NumeroQuartos_1: 15, NumeroQuartos_2: 25, NumeroQuartos_3: 20, NumeroQuartos_4: 10, NumeroQuartos_5: 5 }
    ];
    
    // Simular API de leitura de arquivos
    window.fs = {
      readFile: async function(filename) {
        console.log("Simulando leitura do arquivo:", filename);
        
        if (filename.includes("transacoes_sancashop.xlsx")) {
          // Criando um objeto XLSX simulado
          const wb = {
            SheetNames: ["Transacoes"],
            Sheets: {
              Transacoes: {}
            }
          };
          
          // Retornando uma promessa resolvida com os dados
          return Promise.resolve(new Uint8Array([1,2,3,4])); // Dados fictícios
        } 
        else if (filename.includes("Sancashop_Apts_por_Condo.xlsx")) {
          // Para o arquivo de apartamentos
          return Promise.resolve(new Uint8Array([5,6,7,8])); // Dados fictícios
        }
      }
    };
    
    // Modificar o objeto XLSX global para usar nossos dados simulados
    window.XLSX_original = XLSX;
    window.XLSX = {
      ...XLSX,
      read: function(data, options) {
        // Verifica qual arquivo estamos tentando ler
        console.log("Lendo dados com XLSX");
        return {
          SheetNames: ["Sheet1"],
          Sheets: {
            Sheet1: {}
          }
        };
      },
      utils: {
        ...XLSX.utils,
        sheet_to_json: function(sheet) {
          // Retorna os dados apropriados dependendo do contexto
          if (window.ultimoArquivoLido && window.ultimoArquivoLido.includes("transacoes")) {
            return DADOS_TRANSACOES;
          } else {
            return DADOS_APTS;
          }
        }
      }
    };
    
    // Interceptar a chamada para window.fs.readFile para rastrear qual arquivo está sendo lido
    const originalReadFile = window.fs.readFile;
    window.fs.readFile = async function(filename, options) {
      window.ultimoArquivoLido = filename;
      return originalReadFile(filename, options);
    };
  </script>
<!-- Código do Dashboard -->
  <script type="text/babel">
    // Componentes Recharts
    const {
      LineChart, Line, BarChart, Bar, XAxis, YAxis, 
      CartesianGrid, Tooltip, Legend, ResponsiveContainer
    } = Recharts;
    
    // Componente Dashboard
    const Dashboard = () => {
      // Estados para armazenar dados e seleções
      const [dadosProcessados, setDadosProcessados] = React.useState([]);
      const [pdvs, setPdvs] = React.useState([]);
      const [pdvsSelecionados, setPdvsSelecionados] = React.useState([]);
      const [isLoading, setIsLoading] = React.useState(true);
      const [error, setError] = React.useState(null);

      // Cores para os gráficos
      const colors = ['#8884d8', '#82ca9d', '#ffc658', '#ff8042', '#0088fe', '#00C49F'];

      // Função para processar os dados
      React.useEffect(() => {
        const processarDados = async () => {
          try {
            setIsLoading(true);
            
            // Ler arquivo de transações
            const arquivoTransacoes = await window.fs.readFile('transacoes_sancashop.xlsx');
            const wb = XLSX.read(arquivoTransacoes, { cellDates: true });
            const sheet = wb.Sheets[wb.SheetNames[0]];
            const transacoes = XLSX.utils.sheet_to_json(sheet);
            
            // Ler arquivo de apartamentos
            const arquivoApts = await window.fs.readFile('Sancashop_Apts_por_Condo.xlsx');
            const wbApts = XLSX.read(arquivoApts, { cellDates: true });
            const sheetApts = wbApts.Sheets[wbApts.SheetNames[0]];
            const dadosApts = XLSX.utils.sheet_to_json(sheetApts);
            
            // Criar mapeamento de condomínios para número de apartamentos
            const mapaCondo = {};
            dadosApts.forEach(item => {
              const totalApts = 
                (parseInt(item.NumeroQuartos_1 || 0)) +
                (parseInt(item.NumeroQuartos_2 || 0)) +
                (parseInt(item.NumeroQuartos_3 || 0)) +
                (parseInt(item.NumeroQuartos_4 || 0)) +
                (parseInt(item.NumeroQuartos_5 || 0));
              
              const nomeNormalizado = item.CodigoLoja.trim();
              mapaCondo[nomeNormalizado] = totalApts;
            });
            
            // Extrair todos PDVs únicos
            const todosPDVs = [...new Set(transacoes.map(trans => trans.Local))].sort();
            setPdvs(todosPDVs);
            
            // Se nenhum PDV selecionado, selecionar os 5 primeiros
            if (pdvsSelecionados.length === 0 && todosPDVs.length > 0) {
              setPdvsSelecionados(todosPDVs.slice(0, Math.min(5, todosPDVs.length)));
            }
            
            // Processar transações
            const transacoesProcessadas = transacoes.map(trans => {
              let dataObj;
              
              if (typeof trans.Datahora === 'string') {
                dataObj = new Date(trans.Datahora);
              } else if (trans.Datahora instanceof Date) {
                dataObj = trans.Datahora;
              } else {
                dataObj = new Date(); // Fallback
              }
              
              const diaDaSemana = dataObj.getDay(); // 0-6
              const ehFimDeSemana = diaDaSemana === 0 || diaDaSemana === 6;
              
              const ano = dataObj.getFullYear();
              const mes = dataObj.getMonth() + 1; // 1-12
              const chaveAnoMes = `${ano}-${mes.toString().padStart(2, '0')}`;
              const nomeMes = obterNomeMes(mes);
              
              return {
                ...trans,
                dataObj,
                diaDaSemana,
                ehFimDeSemana,
                ano,
                mes,
                chaveAnoMes,
                nomeMes,
                valorVenda: parseFloat(trans.PrecoVenda) || 0
              };
            });
            
            // Agrupar transações por PDV, ano-mês e tipo de dia (útil ou fim de semana)
            const agrupadoPorPDVMesTipoDia = _.groupBy(transacoesProcessadas, trans => 
              `${trans.Local}|${trans.chaveAnoMes}|${trans.ehFimDeSemana ? 'fds' : 'util'}`
            );
            
            // Calcular totais
            const dadosAgrupados = [];
            
            Object.entries(agrupadoPorPDVMesTipoDia).forEach(([chave, grupo]) => {
              const [pdv, anoMes, tipoDia] = chave.split('|');
              const [ano, mes] = anoMes.split('-').map(Number);
              const nomeMes = obterNomeMes(mes);
              const mesPeriodo = `${nomeMes}/${ano}`;
              
              // Somar valores das transações
              const valorTotal = _.sumBy(grupo, item => item.valorVenda);
              const qtdTransacoes = grupo.length;
              
              // Encontrar o condomínio correspondente no mapa
              let numApartamentos = 0;
              Object.entries(mapaCondo).forEach(([condoNome, numApts]) => {
                if (pdv.includes(condoNome) || condoNome.includes(pdv)) {
                  numApartamentos = numApts;
                }
              });
              
              // Se não encontrou match exato, tentar match parcial
              if (numApartamentos === 0) {
                const pdvLower = pdv.toLowerCase();
                const matchParcial = Object.keys(mapaCondo).find(condo => 
                  pdvLower.includes(condo.toLowerCase()) || 
                  condo.toLowerCase().includes(pdvLower)
                );
                
                if (matchParcial) {
                  numApartamentos = mapaCondo[matchParcial];
                }
              }
              
              // Verificar se é fevereiro de 2025 para ajuste
              let diasNoMes;
              if (ano === 2025 && mes === 2) {
                // Dados até dia 25
                diasNoMes = 25;
              } else {
                // Número total de dias no mês
                diasNoMes = new Date(ano, mes, 0).getDate();
              }
              
              // Contar dias úteis e fins de semana no mês
              let diasUteis = 0;
              let diasFDS = 0;
              
              for (let dia = 1; dia <= diasNoMes; dia++) {
                const data = new Date(ano, mes - 1, dia);
                const diaSemana = data.getDay();
                if (diaSemana === 0 || diaSemana === 6) {
                  diasFDS++;
                } else {
                  diasUteis++;
                }
              }
              
              // Calcular valor por dia
              const diasNoTipo = tipoDia === 'util' ? diasUteis : diasFDS;
              const valorPorDia = diasNoTipo > 0 ? valorTotal / diasNoTipo : 0;
              
              // Calcular valor por apartamento
              const valorPorApt = numApartamentos > 0 ? valorTotal / numApartamentos : 0;
              
              dadosAgrupados.push({
                pdv,
                anoMes,
                ano,
                mes,
                nomeMes,
                mesPeriodo,
                tipoDia: tipoDia === 'util' ? 'Dia Útil' : 'Fim de Semana/Feriado',
                valorTotal,
                qtdTransacoes,
                numApartamentos,
                valorPorDia,
                valorPorApt,
                diasUteis,
                diasFDS,
                ordem: ano * 100 + mes // Para ordenação
              });
            });
            
            // Ordenar por data
            const dadosOrdenados = _.sortBy(dadosAgrupados, ['ordem', 'pdv', 'tipoDia']);
            setDadosProcessados(dadosOrdenados);
            setIsLoading(false);
          } catch (error) {
            console.error('Erro ao processar dados:', error);
            setError('Erro ao processar os dados. Por favor, tente novamente.');
            setIsLoading(false);
          }
        };
        
        processarDados();
      }, []);
      
      // Função para obter nome do mês
      const obterNomeMes = (mes) => {
        const meses = [
          'Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun',
          'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'
        ];
        return meses[mes - 1];
      };
      
      // Função para formatar valor em reais
      const formatarReais = (valor) => {
        return new Intl.NumberFormat('pt-BR', {
          style: 'currency',
          currency: 'BRL'
        }).format(valor);
      };
      
      // Função para alternar seleção de PDV
      const togglePDV = (pdv) => {
        if (pdvsSelecionados.includes(pdv)) {
          setPdvsSelecionados(pdvsSelecionados.filter(p => p !== pdv));
        } else {
          setPdvsSelecionados([...pdvsSelecionados, pdv]);
        }
      };
      
      // Filtrar dados com base nos PDVs selecionados
      const dadosFiltrados = dadosProcessados.filter(d => pdvsSelecionados.includes(d.pdv));
      
      // Dados para gráficos da Parte 1
      const prepararDadosGrafico1 = () => {
        // Agrupar por mês e tipo de dia, somando valores por dia
        const dadosAgrupados = _.groupBy(dadosFiltrados, d => `${d.mesPeriodo}|${d.tipoDia}`);
        
        const dadosGrafico = Object.entries(dadosAgrupados).map(([chave, grupo]) => {
          const [mesPeriodo, tipoDia] = chave.split('|');
          
          // Somar valores por dia de todos os PDVs selecionados
          const somaValorPorDia = _.sumBy(grupo, 'valorPorDia');
          
          return {
            mesPeriodo,
            tipoDia,
            valor: somaValorPorDia,
            ordem: grupo[0].ordem
          };
        });
        
        return _.sortBy(dadosGrafico, 'ordem');
      };
      
      // Dados para gráficos da Parte 2
      const prepararDadosGrafico2 = () => {
        // Por PDV, mês e tipo de dia
        const dadosPorPDVMesTipo = dadosFiltrados.map(d => ({
          pdv: d.pdv,
          mesPeriodo: d.mesPeriodo,
          tipoDia: d.tipoDia,
          valorPorDia: d.valorPorDia,
          valorPorApt: d.valorPorApt,
          ordem: d.ordem
        }));
        
        return _.sortBy(dadosPorPDVMesTipo, ['ordem', 'pdv']);
      };
      
      // Dados agrupados por dia útil vs fim de semana
      const dadosGrafico1 = prepararDadosGrafico1();
      
      // Dados detalhados por PDV
      const dadosGrafico2 = prepararDadosGrafico2();
      
      // Configuração para tooltips personalizados
      const CustomTooltip = ({ active, payload, label }) => {
        if (active && payload && payload.length) {
          return (
            <div className="bg-white p-4 border border-gray-200 shadow-lg rounded">
              <p className="font-bold">{label}</p>
              {payload.map((entry, index) => (
                <p key={index} style={{ color: entry.color }}>
                  {`${entry.name}: ${formatarReais(entry.value)}`}
                </p>
              ))}
            </div>
          );
        }
        return null;
      };
      
      // Renderizar componente carregando
      if (isLoading) {
        return (
          <div className="flex items-center justify-center min-h-screen">
            <div className="text-center">
              <div className="text-xl font-bold mb-4">Carregando dados...</div>
              <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
            </div>
          </div>
        );
      }
      
      // Renderizar mensagem de erro, se houver
      if (error) {
        return (
          <div className="flex items-center justify-center min-h-screen">
            <div className="text-center text-red-500 font-bold">
              {error}
            </div>
          </div>
        );
      }
      
      // Calcular dados para o gráfico de dias úteis
      const dadosDiasUteis = dadosGrafico1.filter(d => d.tipoDia === 'Dia Útil');
      
      // Calcular dados para o gráfico de fins de semana
      const dadosFimDeSemana = dadosGrafico1.filter(d => d.tipoDia === 'Fim de Semana/Feriado');
      
      // Obter períodos (meses) únicos para os gráficos
      const periodos = _.uniqBy(dadosGrafico1, 'mesPeriodo').map(d => d.mesPeriodo);
      periodos.sort((a, b) => {
        const [mesA, anoA] = a.split('/');
        const [mesB, anoB] = b.split('/');
        const meses = { 'Jan': 1, 'Fev': 2, 'Mar': 3, 'Abr': 4, 'Mai': 5, 'Jun': 6, 'Jul': 7, 'Ago': 8, 'Set': 9, 'Out': 10, 'Nov': 11, 'Dez': 12 };
        return (parseInt(anoA) * 100 + meses[mesA]) - (parseInt(anoB) * 100 + meses[mesB]);
      });
      
      // Preparar dados para o gráfico por apartamento
      const dadosPorApartamento = pdvsSelecionados.map(pdv => {
        const dadosPDV = dadosFiltrados.filter(d => d.pdv === pdv);
        const result = {};
        
        result.pdv = pdv;
        
        periodos.forEach(periodo => {
          const dadosPeriodo = dadosPDV.filter(d => d.mesPeriodo === periodo);
          const valorTotal = _.sumBy(dadosPeriodo, 'valorTotal');
          const numApts = dadosPeriodo.length > 0 ? dadosPeriodo[0].numApartamentos : 0;
          
          result[periodo] = numApts > 0 ? valorTotal / numApts : 0;
        });
        
        return result;
      });
      
      return (
        <div className="p-4 bg-gray-50 min-h-screen">
          <h1 className="text-2xl font-bold text-center mb-6">Dashboard Sancashop - Análise de Faturamento</h1>
          
          {/* Seletor de PDVs */}
          <div className="mb-6 p-4 bg-white rounded-lg shadow">
            <h2 className="text-lg font-semibold mb-2">Selecione os PDVs:</h2>
            <div className="flex mb-2">
              <button
                onClick={() => setPdvsSelecionados([...pdvs])}
                className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors mr-2 ${
                  pdvsSelecionados.length === pdvs.length
                    ? 'bg-green-500 text-white'
                    : 'bg-green-100 text-green-700 hover:bg-green-200'
                }`}
              >
                Selecionar Todos
              </button>
              <button
                onClick={() => setPdvsSelecionados([])}
                className="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200"
              >
                Limpar Seleção
              </button>
            </div>
            <div className="flex flex-wrap gap-2 max-h-40 overflow-y-auto p-2">
              {pdvs.map((pdv, index) => (
                <button
                  key={index}
                  onClick={() => togglePDV(pdv)}
                  className={`px-3 py-1 rounded-full text-sm font-medium transition-colors ${
                    pdvsSelecionados.includes(pdv)
                      ? 'bg-blue-500 text-white'
                      : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                  }`}
                >
                  {pdv}
                </button>
              ))}
            </div>
            <div className="mt-2 text-sm text-gray-500">
              {pdvsSelecionados.length} PDV(s) selecionado(s) de {pdvs.length}
            </div>
          </div>
          
          {/* Parte 1: Evolução mensal do faturamento */}
          <div className="mb-8">
            <h2 className="text-xl font-bold mb-4 p-2 bg-blue-50 border-l-4 border-blue-500">
              Parte 1: Evolução Mensal do Faturamento por Dia
            </h2>
            
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Gráfico 1: Faturamento por Dia Útil */}
              <div className="bg-white p-4 rounded-lg shadow">
                <h3 className="text-lg font-semibold mb-3">Faturamento por Dia Útil</h3>
                <ResponsiveContainer width="100%" height={250}>
                  <LineChart
                    data={dadosDiasUteis}
                    margin={{ top: 5, right: 20, left: 20, bottom: 5 }}
                  >
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="mesPeriodo" />
                    <YAxis tickFormatter={(value) => `R$ ${(value / 1000).toFixed(1)}k`} />
                    <Tooltip content={<CustomTooltip />} />
                    <Legend />
                    <Line 
                      type="monotone" 
                      dataKey="valor" 
                      name="Valor por Dia Útil" 
                      stroke="#8884d8" 
                      activeDot={{ r: 8 }} 
                    />
                  </LineChart>
                </ResponsiveContainer>
              </div>

              {/* Gráfico 2: Faturamento por Fim de Semana/Feriado */}
              <div className="bg-white p-4 rounded-lg shadow">
                <h3 className="text-lg font-semibold mb-3">Faturamento por Fim de Semana/Feriado</h3>
                <ResponsiveContainer width="100%" height={250}>
                  <LineChart
                    data={dadosFimDeSemana}
                    margin={{ top: 5, right: 20, left: 20, bottom: 5 }}
                  >
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="mesPeriodo" />
                    <YAxis tickFormatter={(value) => `R$ ${(value / 1000).toFixed(1)}k`} />
                    <Tooltip content={<CustomTooltip />} />
                    <Legend />
                    <Line 
                      type="monotone" 
                      dataKey="valor" 
                      name="Valor por Fim de Semana" 
                      stroke="#82ca9d" 
                      activeDot={{ r: 8 }} 
                    />
                  </LineChart>
                </ResponsiveContainer>
              </div>

              {/* Gráfico 3: Comparativo Dia Útil vs. Fim de Semana */}
              <div className="bg-white p-4 rounded-lg shadow">
                <h3 className="text-lg font-semibold mb-3">Comparativo: Dia Útil vs. Fim de Semana</h3>
                <ResponsiveContainer width="100%" height={250}>
                  <BarChart
                    data={periodos.map(periodo => {
                      const diaUtil = dadosDiasUteis.find(d => d.mesPeriodo === periodo);
                      const fimDeSemana = dadosFimDeSemana.find(d => d.mesPeriodo === periodo);
                      
                      return {
                        mesPeriodo: periodo,
                        'Dia Útil': diaUtil ? diaUtil.valor : 0,
                        'Fim de Semana': fimDeSemana ? fimDeSemana.valor : 0
                      };
                    })}
                    margin={{ top: 5, right: 20, left: 20, bottom: 5 }}
                  >
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="mesPeriodo" />
                    <YAxis tickFormatter={(value) => `R$ ${(value / 1000).toFixed(1)}k`} />
                    <Tooltip content={<CustomTooltip />} />
                    <Legend />
                    <Bar dataKey="Dia Útil" fill="#8884d8" />
                    <Bar dataKey="Fim de Semana" fill="#82ca9d" />
                  </BarChart>
                </ResponsiveContainer>
              </div>
            </div>
          </div>

          {/* Parte 2: Evolução por PDV */}
          <div>
            <h2 className="text-xl font-bold mb-4 p-2 bg-blue-50 border-l-4 border-blue-500">
              Parte 2: Evolução do Faturamento por PDV
            </h2>
            
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
              {/* Gráfico 4: Faturamento por Dia Útil por PDV */}
              <div className="bg-white p-4 rounded-lg shadow">
                <h3 className="text-lg font-semibold mb-3">Faturamento por Dia Útil por PDV</h3>
                <ResponsiveContainer width="100%" height={250}>
                  <LineChart
                    data={periodos.map(periodo => {
                      const result = { mesPeriodo: periodo };
                      
                      pdvsSelecionados.forEach((pdv, index) => {
                        const dadoPDV = dadosGrafico2.find(
                          d => d.pdv === pdv && d.mesPeriodo === periodo && d.tipoDia === 'Dia Útil'
                        );
                        result[pdv] = dadoPDV ? dadoPDV.valorPorDia : 0;
                      });
                      
                      return result;
                    })}
                    margin={{ top: 5, right: 20, left: 20, bottom: 5 }}
                  >
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="mesPeriodo" />
                    <YAxis tickFormatter={(value) => `R$ ${(value / 1000).toFixed(1)}k`} />
                    <Tooltip content={<CustomTooltip />} />
                    <Legend />
                    {pdvsSelecionados.map((pdv, index) => (
                      <Line 
                        key={index}
                        type="monotone" 
                        dataKey={pdv} 
                        name={pdv} 
                        stroke={colors[index % colors.length]} 
                        activeDot={{ r: 8 }}
                        strokeWidth={2}
                      />
                    ))}
                  </LineChart>
                </ResponsiveContainer>
              </div>

              {/* Gráfico 5: Faturamento por Fim de Semana por PDV */}
              <div className="bg-white p-4 rounded-lg shadow">
                <h3 className="text-lg font-semibold mb-3">Faturamento por Fim de Semana por PDV</h3>
                <ResponsiveContainer width="100%" height={250}>
                  <LineChart
                    data={periodos.map(periodo => {
                      const result = { mesPeriodo: periodo };
                      
                      pdvsSelecionados.forEach((pdv, index) => {
                        const dadoPDV = dadosGrafico2.find(
                          d => d.pdv === pdv && d.mesPeriodo === periodo && d.tipoDia === 'Fim de Semana/Feriado'
                        );
                        result[pdv] = dadoPDV ? dadoPDV.valorPorDia : 0;
                      });
                      
                      return result;
                    })}
                    margin={{ top: 5, right: 20, left: 20, bottom: 5 }}
                  >
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="mesPeriodo" />
                    <YAxis tickFormatter={(value) => `R$ ${(value / 1000).toFixed(1)}k`} />
                    <Tooltip content={<CustomTooltip />} />
                    <Legend />
                    {pdvsSelecionados.map((pdv, index) => (
                      <Line 
                        key={index}
                        type="monotone" 
                        dataKey={pdv} 
                        name={pdv} 
                        stroke={colors[index % colors.length]} 
                        activeDot={{ r: 8 }}
                        strokeWidth={2}
                      />
                    ))}
                  </LineChart>
                </ResponsiveContainer>
              </div>
            </div>

            {/* Gráficos de Faturamento por Apartamento */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Gráfico 6: Faturamento por Apartamento por PDV por Dia Útil */}
              <div className="bg-white p-4 rounded-lg shadow">
                <h3 className="text-lg font-semibold mb-3">Faturamento por Apartamento por PDV por Dia Útil</h3>
                <ResponsiveContainer width="100%" height={250}>
                  <LineChart
                    data={periodos.map(periodo => {
                      const result = { mesPeriodo: periodo };
                      
                      pdvsSelecionados.forEach(pdv => {
                        // Encontrar dados do período para este PDV
                        const dadosPDV = dadosFiltrados.filter(d => 
                          d.pdv === pdv && 
                          d.mesPeriodo === periodo && 
                          d.tipoDia === 'Dia Útil'
                        );
                        
                        // Calcular valor por apartamento para dias úteis
                        if (dadosPDV.length > 0) {
                          const totalValor = _.sumBy(dadosPDV, 'valorTotal');
                          const numApts = dadosPDV[0].numApartamentos;
                          const diasUteis = dadosPDV[0].diasUteis;
                          
                          if (numApts > 0 && diasUteis > 0) {
                            // Valor médio por apartamento por dia útil
                            result[pdv] = (totalValor / numApts) / diasUteis;
                          } else {
                            result[pdv] = 0;
                          }
                        } else {
                          result[pdv] = 0;
                        }
                      });
                      
                      return result;
                    })}
                    margin={{ top: 5, right: 20, left: 20, bottom: 5 }}
                  >
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="mesPeriodo" />
                    <YAxis tickFormatter={(value) => `R$ ${value.toFixed(2)}`} />
                    <Tooltip content={<CustomTooltip />} />
                    <Legend />
                    {pdvsSelecionados.map((pdv, index) => (
                      <Line 
                        key={index}
                        type="monotone" 
                        dataKey={pdv} 
                        name={pdv} 
                        stroke={colors[index % colors.length]} 
                        activeDot={{ r: 8 }}
                        strokeWidth={2}
                      />
                    ))}
                  </LineChart>
                </ResponsiveContainer>
              </div>

              {/* Gráfico 7: Faturamento por Apartamento por PDV por Fim de Semana */}
              <div className="bg-white p-4 rounded-lg shadow">
                <h3 className="text-lg font-semibold mb-3">Faturamento por Apartamento por PDV por Fim de Semana</h3>
                <ResponsiveContainer width="100%" height={250}>
                  <LineChart
                    data={periodos.map(periodo => {
                      const result = { mesPeriodo: periodo };
                      
                      pdvsSelecionados.forEach(pdv => {
                        // Encontrar dados do período para este PDV
                        const dadosPDV = dadosFiltrados.filter(d => 
                          d.pdv === pdv && 
                          d.mesPeriodo === periodo && 
                          d.tipoDia === 'Fim de Semana/Feriado'
                        );
                        
                        // Calcular valor por apartamento para fins de semana
                        if (dadosPDV.length > 0) {
                          const totalValor = _.sumBy
			  const totalValor = _.sumBy(dadosPDV, 'valorTotal');
                          const numApts = dadosPDV[0].numApartamentos;
                          const diasFDS = dadosPDV[0].diasFDS;
                          
                          if (numApts > 0 && diasFDS > 0) {
                            // Valor médio por apartamento por dia de fim de semana
                            result[pdv] = (totalValor / numApts) / diasFDS;
                          } else {
                            result[pdv] = 0;
                          }
                        } else {
                          result[pdv] = 0;
                        }
                      });
                      
                      return result;
                    })}
                    margin={{ top: 5, right: 20, left: 20, bottom: 5 }}
                  >
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="mesPeriodo" />
                    <YAxis tickFormatter={(value) => `R$ ${value.toFixed(2)}`} />
                    <Tooltip content={<CustomTooltip />} />
                    <Legend />
                    {pdvsSelecionados.map((pdv, index) => (
                      <Line 
                        key={index}
                        type="monotone" 
                        dataKey={pdv} 
                        name={pdv} 
                        stroke={colors[index % colors.length]} 
                        activeDot={{ r: 8 }}
                        strokeWidth={2}
                      />
                    ))}
                  </LineChart>
                </ResponsiveContainer>
              </div>
            </div>
          </div>
          
          {/* Informações e Legenda */}
          <div className="mt-8 p-4 bg-blue-50 rounded-lg border border-blue-200">
            <h3 className="font-bold">Notas:</h3>
            <ul className="list-disc pl-5 text-sm">
              <li>Os valores para Fevereiro/2025 foram ajustados para considerar apenas até o dia 25.</li>
              <li>Faturamento por dia: valores médios diários considerando apenas os dias úteis ou fins de semana no mês.</li>
              <li>Faturamento por apartamento por dia: valor total mensal dividido pelo número de apartamentos e depois pelo número de dias (úteis ou de fim de semana) no mês.</li>
              <li>Selecione os PDVs de interesse clicando nos botões acima. Use "Selecionar Todos" para visualizar todos os PDVs ou "Limpar Seleção" para desmarcar todos.</li>
            </ul>
          </div>
        </div>
      );
    };

    // Renderizar o dashboard
    ReactDOM.render(<Dashboard />, document.getElementById('root'));
  </script>
</body>
</html>